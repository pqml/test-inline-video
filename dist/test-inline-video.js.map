{"version":3,"file":"test-inline-video.js","sources":["../src/video.js","../src/index.js","../src/dom.js"],"sourcesContent":["export default 'data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAFttZGF0AAAAMmWIhD///8PAnFAAFPf3333331111111111111111111111111111111111111111114AAAABUGaOeDKAAAABkGaVHgygAAAAAZBmnZ4MoAAAAMKbW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAAB9AAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAjt0cmFrAAAAXHRraGQAAAAPAAAAAAAAAAAAAAABAAAAAAAAB9AAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAGQAAABkAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAfQAAAAAAABAAAAAAGzbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAAAAgAAAARVxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAABXm1pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAR5zdGJsAAAAlnN0c2QAAAAAAAAAAQAAAIZhdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAGQAZABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAAMGF2Y0MBQsAK/+EAGGdCwArZhz+efARAAAADAEAAAAMBA8SJmgEABWjJYPLIAAAAGHN0dHMAAAAAAAAAAQAAAAQAAAABAAAAFHN0c3MAAAAAAAAAAQAAAAEAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAQAAAABAAAAJHN0c3oAAAAAAAAAAAAAAAQAAAA2AAAACQAAAAoAAAAKAAAAFHN0Y28AAAAAAAAAAQAAADAAAABbdWR0YQAAAFNtZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAACZpbHN0AAAAHql0b28AAAAWZGF0YQAAAAEAAAAAR29vZ2xl'\n","import VIDEO from './video'\nimport { css, attr } from './dom'\n\nlet visibilityEvt\nif (typeof document.hidden !== 'undefined') visibilityEvt = { name: 'visibilitychange', key: 'hidden' }\nelse if (typeof document.msHidden !== 'undefined') visibilityEvt = { name: 'msvisibilitychange', key: 'msHidden' }\nelse if (typeof document.webkitHidden !== 'undefined') visibilityEvt = { name: 'webkitvisibilitychange', key: 'webkitHidden' }\n\nfunction createVideo () {\n  let video = document.createElement('video')\n\n  // set video as inline video\n  attr(video, {\n    'autoplay': '',\n    'muted': '',\n    'playsinline': '',\n    'webkit-playsinline': ''\n  })\n\n  // stylize the video to make it almost invisible\n  css(video, {\n    zIndex: 10000, // Place the video to be visible to avoid iOS not playing it\n    position: 'fixed',\n    top: '50%',\n    left: '50%',\n    width: 1 + 'px',\n    height: 1 + 'px',\n    opacity: 0.01, // can't be 0 or the video won't play on some devices\n    pointerEvents: 'none'\n  })\n\n  return video\n}\n\nexport default function testInlineVideo (opts) {\n  return new Promise((resolve, reject) => {\n    let timer, video\n    opts = opts || {}\n    opts.timeout = opts.timeout || 2000\n\n    init()\n\n    function init () {\n      video = createVideo()\n      video.onload = () => { video.play() }\n      video.src = VIDEO\n      video.addEventListener('timeupdate', onActive)\n      document.body.appendChild(video)\n      if (visibilityEvt) document.addEventListener(visibilityEvt.name, onVisibilityChange, false)\n      timer = createTimer()\n    }\n\n    function createTimer () {\n      return window.setTimeout(() => {\n        dispose()\n        reject(new Error('No support for inline video'))\n      }, opts.timeout)\n    }\n\n    // stop the timer if the user hide the tab, to avoid false-negative results\n    function onVisibilityChange () {\n      window.clearTimeout(timer)\n      if (!document[visibilityEvt.key]) {\n        timer = createTimer()\n      }\n    }\n\n    function onActive () {\n      dispose()\n      resolve()\n    }\n\n    function dispose () {\n      if (visibilityEvt) document.removeEventListener(visibilityEvt.name, onVisibilityChange, false)\n      window.clearTimeout(timer)\n      timer = null\n      video.removeEventListener('timeupdate', onActive)\n      document.body.removeChild(video)\n      video = null\n    }\n  })\n}\n","export function css (element, style) {\n  for (let k in style) element.style[k] = style[k]\n}\n\nexport function attr (element, attrs) {\n  for (let k in attrs) element.setAttribute(k, attrs[k])\n}\n"],"names":["visibilityEvt","document","hidden","name","key","msHidden","webkitHidden","opts","Promise","resolve","reject","let","timer","video","createTimer","window","setTimeout","dispose","Error","timeout","onVisibilityChange","clearTimeout","onActive","removeEventListener","body","removeChild","createElement","element","attrs","k","setAttribute","attr","autoplay","muted","playsinline","webkit-playsinline","style","css","zIndex","position","top","left","width","height","opacity","pointerEvents","createVideo","onload","play","src","VIDEO","addEventListener","appendChild"],"mappings":"AAAA,ICGIA,IDHW,0tCCIgB,IAApBC,SAASC,OAAwBF,GAAkBG,KAAM,mBAAoBC,IAAK,eACvD,IAAtBH,SAASI,SAA0BL,GAAkBG,KAAM,qBAAsBC,IAAK,iBAC5D,IAA1BH,SAASK,eAA8BN,GAAkBG,KAAM,yBAA0BC,IAAK,gCA4B9G,SAAyCG,GACvC,OAAO,IAAIC,iBAASC,EAASC,GAC3BC,IAAIC,EAAOC,EAgBX,SAASC,IACP,OAAOC,OAAOC,sBACZC,IACAP,EAAO,IAAIQ,MAAM,iCAChBX,EAAKY,SAIV,SAASC,IACPL,OAAOM,aAAaT,GACfX,SAASD,EAAcI,OAC1BQ,EAAQE,KAIZ,SAASQ,IACPL,IACAR,IAGF,SAASQ,IACHjB,GAAeC,SAASsB,oBAAoBvB,EAAcG,KAAMiB,GAAoB,GACxFL,OAAOM,aAAaT,GACpBA,EAAQ,KACRC,EAAMU,oBAAoB,aAAcD,GACxCrB,SAASuB,KAAKC,YAAYZ,GAC1BA,EAAQ,MAzCVN,EAAOA,OACFY,QAAUZ,EAAKY,SAAW,KAK7BN,EAnCN,WACEF,IAAIE,EAAQZ,SAASyB,cAAc,SAsBnC,OC3BF,SAAsBC,EAASC,GAC7B,IAAKjB,IAAIkB,KAAKD,EAAOD,EAAQG,aAAaD,EAAGD,EAAMC,IDOnDE,CAAKlB,GACHmB,SAAY,GACZC,MAAS,GACTC,YAAe,GACfC,qBAAsB,KChBnB,SAAcR,EAASS,GAC5B,IAAKzB,IAAIkB,KAAKO,EAAOT,EAAQS,MAAMP,GAAKO,EAAMP,GDmB9CQ,CAAIxB,GACFyB,OAAQ,IACRC,SAAU,QACVC,IAAK,MACLC,KAAM,MACNC,MAAO,MACPC,OAAQ,MACRC,QAAS,IACTC,cAAe,SAGVhC,EAYKiC,IACFC,kBAAiBlC,EAAMmC,QAC7BnC,EAAMoC,IAAMC,EACZrC,EAAMsC,iBAAiB,aAAc7B,GACrCrB,SAASuB,KAAK4B,YAAYvC,GACtBb,GAAeC,SAASkD,iBAAiBnD,EAAcG,KAAMiB,GAAoB,GACrFR,EAAQE"}