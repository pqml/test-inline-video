{"version":3,"file":"test-inline-video.umd.js","sources":["../src/index.js"],"sourcesContent":["const w = window\nconst raf = w.requestAnimationFrame || w.mozRequestAnimationFrame || w.webkitRequestAnimationFrame || w.msRequestAnimationFrame\nconst perf = w.performance || Date\nconst iOS = !!navigator.platform && /iPad|iPhone|iPod/.test(navigator.platform)\nconst saveData = !!navigator.connection && navigator.connection.saveData\n\nlet visibilityEvt\nif (typeof document.hidden !== 'undefined') visibilityEvt = { name: 'visibilitychange', key: 'hidden' }\nelse if (typeof document.msHidden !== 'undefined') visibilityEvt = { name: 'msvisibilitychange', key: 'msHidden' }\nelse if (typeof document.webkitHidden !== 'undefined') visibilityEvt = { name: 'webkitvisibilitychange', key: 'webkitHidden' }\n\nfunction median (values = []) {\n  var numbers = values.slice(0).sort((a, b) => a - b)\n  var middle = Math.floor(numbers.length / 2)\n  var isEven = numbers.length % 2 === 0\n  return isEven ? (numbers[middle] + numbers[middle - 1]) / 2 : numbers[middle]\n}\n\nexport default function testInlineVideo (opts = {}) {\n  return new Promise((resolve, reject) => {\n    let video, playing, nt, skip\n    let fpsCounts = 0\n    let fpsValues = []\n    let lt = 0\n    const out = { autoplay: true, saveData: saveData, iOS: iOS, badFps: false, error: null }\n\n    video = document.createElement('video')\n    document.body.appendChild(video)\n    video.setAttribute('muted', '')\n    video.setAttribute('playsinline', '')\n    video.setAttribute('webkit-playsinline', '')\n    video.setAttribute('width', '1px')\n    video.setAttribute('height', '1px')\n    video.muted = true\n    video.playsinline = true\n    video.webkitPlaysinline = true\n    video.style.cssText = 'z-index:10000;position:fixed;top:50%;left:50%;width:1px;height:1px;opacity:0.01;pointer-events:none;user-select:none'\n\n    new Promise(resolve => resolve(video.play())).catch(() => {})\n    if (video.paused) {\n      out.autoplay = false\n      out.error = new Error('No support for inline video')\n    }\n\n    lt = perf.now()\n    opts.testFramerate ? raf(count) : resolve(out)\n\n    function count () {\n      nt = perf.now()\n      if (skip) {\n        skip = false\n        lt = nt\n        raf(count)\n        return\n      }\n      fpsValues.push(nt - lt)\n      lt = nt\n      if (++fpsCounts < 12) {\n        raf(count)\n      } else {\n        if (visibilityEvt) document.removeEventListener(visibilityEvt.name, visibilityChange, false)\n        if (1000 / median(fpsValues) < 45) out.badFps = true\n        resolve(out)\n      }\n    }\n\n    // reset current fps counting\n    function visibilityChange () {\n      skip = true\n    }\n\n    function dispose () {\n      document.body.removeChild(video)\n      video.onplay = null\n      video.oncanplay = null\n      video.pause()\n      video = null\n    }\n  })\n}\n"],"names":["const","visibilityEvt","w","window","raf","requestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","perf","performance","Date","iOS","navigator","platform","test","saveData","connection","document","hidden","name","key","msHidden","webkitHidden","opts","Promise","resolve","reject","video","nt","skip","fpsCounts","fpsValues","lt","out","autoplay","badFps","error","visibilityChange","createElement","body","appendChild","setAttribute","muted","playsinline","webkitPlaysinline","style","cssText","play","catch","paused","Error","now","testFramerate","count","push","removeEventListener","values","numbers","slice","sort","a","b","middle","Math","floor","length","median"],"mappings":"8KAAAA,IAMIC,EANEC,EAAIC,OACJC,EAAMF,EAAEG,uBAAyBH,EAAEI,0BAA4BJ,EAAEK,6BAA+BL,EAAEM,wBAClGC,EAAOP,EAAEQ,aAAeC,KACxBC,IAAQC,UAAUC,UAAY,mBAAmBC,KAAKF,UAAUC,UAChEE,IAAaH,UAAUI,YAAcJ,UAAUI,WAAWD,qBAGjC,IAApBE,SAASC,OAAwBlB,GAAkBmB,KAAM,mBAAoBC,IAAK,eACvD,IAAtBH,SAASI,SAA0BrB,GAAkBmB,KAAM,qBAAsBC,IAAK,iBAC5D,IAA1BH,SAASK,eAA8BtB,GAAkBmB,KAAM,yBAA0BC,IAAK,iBAS/F,SAA0BG,GACvC,0BAAO,IAAIC,iBAASC,EAASC,GAC3B,IAAIC,EAAOC,EAAaC,EACpBC,EAAY,EACZC,KACAC,EAAK,EACHC,GAAQC,UAAU,EAAMnB,SAAUA,EAAUJ,IAAKA,EAAKwB,QAAQ,EAAOC,MAAO,MA2ClF,SAASC,IACPR,GAAO,EA1CTF,EAAQV,SAASqB,cAAc,SAC/BrB,SAASsB,KAAKC,YAAYb,GAC1BA,EAAMc,aAAa,QAAS,IAC5Bd,EAAMc,aAAa,cAAe,IAClCd,EAAMc,aAAa,qBAAsB,IACzCd,EAAMc,aAAa,QAAS,OAC5Bd,EAAMc,aAAa,SAAU,OAC7Bd,EAAMe,OAAQ,EACdf,EAAMgB,aAAc,EACpBhB,EAAMiB,mBAAoB,EAC1BjB,EAAMkB,MAAMC,QAAU,uHAEtB,IAAItB,iBAAQC,UAAWA,EAAQE,EAAMoB,UAASC,oBAC1CrB,EAAMsB,SACRhB,EAAIC,UAAW,EACfD,EAAIG,MAAQ,IAAIc,MAAM,gCAGxBlB,EAAKxB,EAAK2C,MACV5B,EAAK6B,cAAgBjD,EAErB,SAASkD,IAEP,GADAzB,EAAKpB,EAAK2C,MACNtB,EAIF,OAHAA,GAAO,EACPG,EAAKJ,OACLzB,EAAIkD,GAGNtB,EAAUuB,KAAK1B,EAAKI,GACpBA,EAAKJ,IACCE,EAAY,GAChB3B,EAAIkD,IAEArD,GAAeiB,SAASsC,oBAAoBvD,EAAcmB,KAAMkB,GAAkB,GAClF,IAlDZ,SAAiBmB,sBACf,IAAIC,EAAUD,EAAOE,MAAM,GAAGC,cAAMC,EAAGC,UAAMD,EAAIC,IAC7CC,EAASC,KAAKC,MAAMP,EAAQQ,OAAS,GAEzC,OADaR,EAAQQ,OAAS,GAAM,GACnBR,EAAQK,GAAUL,EAAQK,EAAS,IAAM,EAAIL,EAAQK,GA8CrDI,CAAOnC,GAAa,KAAIE,EAAIE,QAAS,GAChDV,EAAQQ,MAjBsBR,EAAQQ"}